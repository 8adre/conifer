{% extends "main_bootstrap.html" %}

{% block head %}

{{ super() }}

<link rel="stylesheet" href="//cdn.datatables.net/plug-ins/1.10.6/integration/bootstrap/3/dataTables.bootstrap.css"/>

<script type="text/javascript" language="javascript" src="//cdn.datatables.net/1.10.6/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" language="javascript" src="//cdn.datatables.net/plug-ins/1.10.6/integration/bootstrap/3/dataTables.bootstrap.js"></script>


<script src="//code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>

<script src="/static/__shared/jquery.selectBoxIt.min.js"></script>
<link rel="stylesheet" href="/static/__shared/jquery.selectBoxIt.css"/>

<style>
    table.dataTable td, table.dataTable th {
        font-size: 18px;
        font-weight: bold;
    }
    .wr-table {
        display: table;
        float: none;
        vertical-align: bottom;
        width: 100%;
        height: 100%;
        margin-left: 0px;
    }
    .wr-cell {
        display: table-cell;
        float: none;
        vertical-align: bottom;
        height: 100%;
        padding-left: 0px;
        padding-right: 0px;
    }
    .wr-cell:first-of-type {
        border-bottom: 1px solid #ddd;
    }
    .selectboxit-container {
        margin-top: -5px;
    }
</style>

<script>
    function ts_to_date(ts)
    {
        if (ts.length < 14) {
            return ts;
        }

        var datestr = (ts.substring(0, 4) + "-" + 
                       ts.substring(4, 6) + "-" +
                       ts.substring(6, 8) + "T" +
                       ts.substring(8, 10) + ":" +
                       ts.substring(10, 12) + ":" +
                       ts.substring(12, 14) + "-00:00");

        return new Date(datestr).toLocaleString();
    }

    $(document).ready(function() {
        var prefix = "/{{ path }}/";

        var render_title = function (data, type, full, meta) {

            var url = prefix;
            if (full['ts']) {
                url += full['ts'] + "/";
            }
            url += full['url'];

            if (meta.col == 0) {
                var title = data;
                if (!title) {
                    title = full['url'];
                }
            } else if (meta.col == 1) {
                var title = ts_to_date(data);
            } else {
                title = data;
            }

            return '<a href="' + url + '">' + title + '</a>';
        }

        $("#pageTable").dataTable( {
            "ajaxSource": "/_listpages?coll={{ path }}",
            "order": [[ 1, "desc" ]],
            "columns": [
                { "data": "title" },
                { "data": "ts" },
            ],
            "columnDefs": [ {
                "targets": [0, 1],
                "render": render_title,
            }],
        });

        // Tab Nav
        
        $('#thetab a').click(function (e) {
            e.preventDefault();
            $(this).tab('show');
            window.location.hash = e.target.hash;
        });
        
        var hash = window.location.hash;
        if (hash.match('#')) {
            $('#thetab a[href=' + hash +']').tab('show');
        }
        
        // Select
        $("#pageTable_length select").selectBoxIt({native: true});
    });
</script>
{% endblock %}


{% block content %}
<div class="row wr-table">
    <div class="col-md-4 wr-cell">
        <h1>{{ title | default(coll) }}&nbsp;<small>/{{ coll }}</small></h1>
    </div>
    <div class="col-md-8 wr-cell">
        <!-- Nav tabs -->
        <ul id="thetab" class="nav nav-tabs" role="tablist">
            <li role="presentation" class="active"><a href="#pages" aria-controls="pages" role="tab" data-toggle="tab">Pages</a></li>
            <li role="presentation"><a href="#search" aria-controls="search" role="tab" data-toggle="tab">Search</a></li>
            <li role="presentation"><a href="#files" aria-controls="files" role="tab" data-toggle="tab">Files</a></li>
        </ul>
    </div>
</div>


<div role="tabpanel" style="margin-top: 20px">
    <!-- Tab panes -->
    <div class="tab-content">
        <div role="tabpanel" class="tab-pane active" id="pages">
            <table id="pageTable" class="table table-striped table-bordered" cellspacing="0" width="100%">
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Time Recorded</th>
                    </tr>
                </thead>
            </table>
        </div>
        <div role="tabpanel" class="tab-pane" id="search">Search</div>
        <div role="tabpanel" class="tab-pane" id="files">Files</div>
    </div>
</div>


{% endblock %}
