{% if curr_mode == "replay" or curr_mode == "replay-coll" %}
    {# browser selection is open #}
    {% set is_replaying = True %}
    {% set active_browser = browser_data %}
{% endif %}

{% if curr_mode == "new" or not curr_mode %}
    {# browser selection is open #}
    {% set is_new = True %}
{% endif %}

{% if curr_mode == "record" or curr_mode == "patch" %}
    {#
        Once recording, browser selection is locked..
        If a browser was chosen before starting the recording,
        display as read-only in the ui, otherwise hide the widget.
    #}
    {% set is_recording = True %}
    {% set active_browser = browser_data %}
{% endif %}

{% if is_replaying or is_new or (is_recording and active_browser) %}
<div class="input-group-btn">
    <button id='cnt-button' type="button" class="btn btn-default dropdown-toggle{% if is_recording %} disabled{% endif %}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        {% if active_browser %}
            <span class='btn-content'><img src="/static/__shared/browsers/{{ active_browser.name|replace(' ', '-') }}_16x16.png"> {{ active_browser.name }} v{{ active_browser.version }}</span>
        {% else %}
            <span class='btn-content'>(native) Current</span>
        {% endif %}
        {% if not is_recording %} <span class="caret"></span>{% endif %}
    </button>
    {% if is_replaying or is_new %}
        <div class='dropdown-menu'>
            <div class='container'>
                <ul class='row'>
                    <li class='col-xs-2'><h6 class='dropdown-header'>browser</h6></li>
                    <li class='col-xs-2'><h6 class='dropdown-header'>version</h6></li>
                    <li class='col-xs-2'><h6 class='dropdown-header'>release</h6></li>
                    <li class='col-xs-2'><h6 class='dropdown-header'>OS</h6></li>
                    <li class='col-xs-4'><h6 class='dropdown-header'>capabilities</h6></li>
                </ul>
                 {% for browser in cnt_browsers %}
                    <ul class='row cnt-browser{% if active_browser and browser.id == active_browser.id %} active{% endif %}{% if browser.disabled %} disabled{% endif %}' data-browser-id='{{ browser.id }}' data-browser-name='{{ browser.name }}' data-browser-vrs='{{ browser.version }}'>
                        <li class='col-xs-2'>
                            <img src='/static/__shared/browsers/{{ browser.name|replace(' ', '-') }}_16x16.png'>
                            <span>{{ browser.name }}</span>
                        </li>
                        <li class='col-xs-2'>
                            v{{ browser.version }}
                        </li>
                        <li class='col-xs-2'>
                            {{ browser.release }}
                        </li>
                        <li class='col-xs-2'>
                            {{ browser.os }}
                        </li>
                        <li class='col-xs-4'>
                            <span>
                            {%- if browser.capabilities %}
                                {{ browser.capabilities|join(', ') }}
                            {% else %}
                                -
                            {% endif %}
                            </span>
                        </li>
                    </ul>
                {% endfor %}
                <ul class='row cnt-browser{% if not active_browser %} active{% endif %}' data-native='true'>
                    <li class='col-xs-2'>(native) Current</li>
                    <li class='col-xs-2'>-</li>
                    <li class='col-xs-2'>-</li>
                    <li class='col-xs-2'>-</li>
                    <li class='col-xs-4'>-</li>
                </ul>
            </div>
        </div>
    {% endif %}
</div>
{% endif %}